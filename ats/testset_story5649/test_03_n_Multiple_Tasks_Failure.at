# Test Case 03.

# Description:
#   Given a LITP deployment and a LITP plugin, where multiple tasks are
#   generated by the plugin, if a single model item is associated with those
#   tasks and any of the tasks' execution fail, then the model item's state
#   will not be updated.
# Expected result:
#   After any of the tasks' execution fails, the model item state's is not
#   updated.


# Prerequisite - story5649 extension and plugin
add-extensions extensions/story5649_extension
add-plugins plugins/story5649_plugin

# 1. Create a story5649 item with many associated tasks
litp create -p /software/items/item_01 -t story5649 -o name=item_01 number_of_tasks=many

# 2. Check the state of the item before running the plan
assertState -p /software/items/item_01 Initial

# 3. Create the plan and make one of the tasks associated to the item fail
litp create_plan
assertPlanState initial

failCallbackTask cb_success_3 /software/items/item_01

litp run_plan
assertPlanState failed

# 4. Check that the state of the item was not updated and its APD flag is set
#    to False after one of its associated tasks failed
assertState -p /software/items/item_01 Initial
assertAppliedPropertiesDeterminable -p /software/items/item_01 False
